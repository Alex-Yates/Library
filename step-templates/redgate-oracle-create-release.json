{
  "Id": "0aa40fba-949c-4065-a438-010349c3fd0c",
  "Name": "Redgate - Create Oracle Release",
  "Description": "This step will use the [Redgate Oracle Deployment Suite](https://www.red-gate.com/products/oracle-development/deployment-suite-for-oracle/).  It will create a delta sql script and report so you can review it prior to being deployed to the Oracle Server.  This step will download a package containing the scripts generated by Redgate Source Control for Oracle.\n\nPlease note: the Redgate Oracle Deployment Suite must be installed on the target machine for this to work.  The target machine must also have the ability to connect to the Oracle database.",
  "ActionType": "Octopus.TentaclePackage",
  "Version": 1,
  "CommunityActionTemplateId": null,
  "Packages": [
    {
      "Name": "",
      "PackageId": "#{Redgate.Oracle.PackageName}",
      "FeedId": "#{Redgate.Oracle.PackageFeed}",
      "AcquisitionLocation": "Server",
      "Properties": {}
    }
  ],
  "Properties": {
    "Octopus.Action.Package.AutomaticallyRunConfigurationTransformationFiles": "True",
    "Octopus.Action.Package.AutomaticallyUpdateAppSettingsAndConnectionStrings": "True",
    "Octopus.Action.EnabledFeatures": "Octopus.Features.CustomScripts",
    "Octopus.Action.CustomScripts.PostDeploy.ps1": "$exportPath = $OctopusParameters[\"Redgate.Oracle.ExportPath\"]\n$server = $OctopusParameters[\"Redgate.Oracle.Server\"]\n$user = $OctopusParameters[\"Redgate.Oracle.Username\"]\n$password = $OctopusParameters[\"Redgate.Oracle.Password\"]\n$oracleTools = $OctopusParameters[\"Redgate.Oracle.InstallPath\"]\n$deploymentSchema = $OctopusParameters[\"Redgate.Oracle.DeploymentSchema\"]\n$sourceSchema = $OctopusParameters[\"Redgate.Oracle.SourceSchema\"]\n$packageInstallDirectory = $OctopusParameters[\"Octopus.Action.Package.InstallationDirectoryPath\"]\n\nWrite-Host \"Export Path: $exportPath\"\nWrite-Host \"Oracle Server: $server\"\nWrite-Host \"Oracle Username: $user\"\nWrite-Host \"Oracle Password not shown\"\nWrite-Host \"Oracle Source Schema: $sourceSchema\"\nWrite-Host \"Oracle Deployment Schema: $deploymentSchema\"\nWrite-Host \"Oracle Toolbelt Install Path: $oracleTools\"\nWrite-Host \"Package Install Directory: $packageInstallDirectory\"\n\n$sourceFolder = \"$packageInstallDirectory\\{$sourceSchema}\"\nWrite-Host \"Source Folder: $sourceFolder\"\n\n$maskedConnectionString = \"$user/*****@$server{$deploymentSchema}\"\n$unmaskedConnectionString = \"$user/$password@$server{$deploymentSchema}\"\nWrite-Host \"Creating a delta script by connecting to: $maskedConnectionString\"\n\n$schemaCompareExe = \"$oracleTools\\Schema Compare for Oracle 4\\SCO.exe\"\nWrite-Host \"Running the exe $schemaCompareExe\"\n\n$deltaReportPath = \"$exportPath\\PreDeploy.html\"\nWrite-Host \"Creating the delta report $deltaReportPath\"\n\n$changeScript = \"$exportPath\\Delta.sql\"\nWrite-Host \"Creating the delta script $changeScript\"\n& \"$schemaCompareExe\" /source $sourceFolder /target $unmaskedConnectionString /includeidentical /scriptfile:\"$changeScript\" /report:\"$deltaReportPath\" /reporttype:Simple\n\n$successful = $false\n$upload = $false\nif ($lastExitCode -eq 61){\n\t$successful = $true\n    $upload = $true\n}\n\nif ($lastExitCode -eq 0){\n\t$successful = $true\n}\n\nif ($upload){\n  $environmentName = $OctopusParameters[\"Octopus.Environment.Name\"]\n  $artifactName = \"$environmentName\" + \"PreDeploy.html\"\n  New-OctopusArtifact -Path \"$deltaReportPath\" -Name \"$artifactName\"\n  \n  $scriptArtifactName = \"$environmentName\" + \"Delta.sql\"\n  New-OctopusArtifact -Path \"$changeScript\" -Name \"$scriptArtifactName\"\n}\n  \nif ($successful){  \n  exit 0\n}",
    "Octopus.Action.Package.PackageId": "#{Redgate.Oracle.PackageName}",
    "Octopus.Action.Package.FeedId": "#{Redgate.Oracle.PackageFeed}",
    "Octopus.Action.Package.DownloadOnTentacle": "False"
  },
  "Parameters": [
    {
      "Id": "fed1466b-b5d2-4815-9b54-7b7e696a97aa",
      "Name": "Redgate.Oracle.InstallPath",
      "Label": "Oracle Toolbelt Install Path",
      "HelpText": "The location where the Oracle Tools are installed to",
      "DefaultValue": "C:\\Program Files\\Red Gate\\",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Id": "bdeab5b9-c12c-43d8-9919-10e7c4a0e742",
      "Name": "Redgate.Oracle.PackageFeed",
      "Label": "Package Feed Id",
      "HelpText": "The id of the package feed to use.  This will use the default feed id.  If you need to use another feed id you can go to library -> external feeds and select the feed you want to use.  If you look in the url, that is the feed id.",
      "DefaultValue": "feeds-builtin",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Id": "67da3f13-b1ca-48bb-a81a-dc3efe53dea3",
      "Name": "Redgate.Oracle.PackageName",
      "Label": "Package Name",
      "HelpText": "The name of the package to deploy",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Id": "e12c322b-7e60-4b0e-8d80-2dbc2abca58f",
      "Name": "Redgate.Oracle.ExportPath",
      "Label": "Export Path",
      "HelpText": "The path where the scripts and reports will be exported to",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Id": "ee435c96-3542-4b38-ad12-c38fc607c23d",
      "Name": "Redgate.Oracle.Server",
      "Label": "Oracle Server",
      "HelpText": "The Oracle Server (or host) you wish to deploy to",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Id": "8d19f141-b250-4fc5-999d-457549cd041f",
      "Name": "Redgate.Oracle.Username",
      "Label": "Oracle Username",
      "HelpText": "The username of the user to sign with",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Id": "138eff39-87e6-462d-808c-70259fd251cc",
      "Name": "Redgate.Oracle.Password",
      "Label": "Oracle User Password",
      "HelpText": "The password of the user to login with",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "Sensitive"
      }
    },
    {
      "Id": "3e164f6c-1bcd-4318-a72c-65bf21d64c9a",
      "Name": "Redgate.Oracle.SourceSchema",
      "Label": "Source Schema",
      "HelpText": "The source schema you wish to deploy from",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    },
    {
      "Id": "49225f70-591c-4626-abc2-e351065b7510",
      "Name": "Redgate.Oracle.DeploymentSchema",
      "Label": "Deployment Schema",
      "HelpText": "The schema being deployed",
      "DefaultValue": "",
      "DisplaySettings": {
        "Octopus.ControlType": "SingleLineText"
      }
    }
  ],
  "LastModifiedOn": "2018-10-12T14:34Z",
  "LastModifiedBy": "octopusbob",
  "$Meta": {
    "ExportedAt": "2018-10-12T18:54:49.750Z",
    "OctopusVersion": "2018.8.8",
    "Type": "ActionTemplate"
  },
  "Category": "redgate"  
}